### 什么是单元测试

在软件开发领域, 长期以来人们有一个朴素的愿望，希望通过类似搭积木的方式，将**组件**一层层组合起来完成开发工作。愿望很美好，但目前来看是革命尚未成功，同志们仍需努力。但另一层面也揭示了软件由各类组件组合而成，那怎么保证每个组件组合起来如预期那样工作呢？自然人们引入**测试**方法来验证组件是否按规定的契约来运行。如果把组件一直细分到不能再分最低级别的程序单元，针对这种单元的测试称之为单元测试，在现实世界通常对应到一个对象的方法或函数。单元测试是由程序员来实施的白盒测试，其目的是在对集成测试和功能测试前对基本的程序单元逐一检查验证。关于测试的整体关系参考下面的**测试金字塔**。

![测试金字塔](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL21tYml6X3BuZy9mQ3BkMWNmOGlhY2FMcVVseWZTQ1JWTHdKQ2dhNUNCc1d0a0t1Q2FvV080ZkhWQVpLajluM1RLRGxxSlVKTEZQeEMzVGM0RFF2dmZpYUxIQWZuNkhQMHJ3LzY0MA?x-oss-process=image/format,png)

### 为什么要单元测试

很多同学认为实现了功能逻辑，再编写单元测试有点多余，增加了开发的工作量, 意义不大。单元测试有点类似价值投资，随着软件规模的扩大和演化，会产生越来越大的价值。

#### 驱动优秀设计

良好的设计接口清晰，抽象合理，符合基本的设计原则，编写测试总是流畅自然，如果你发现测试编写困难，如陷泥团，也许这是对你当前设计坏味道的提醒。

#### 安全防护网

当为系统编写的单元测试越来越多, 系统的代码都有测试用例覆盖，单元测试就演变成一张安全防护网，保障大部分系统修改缺陷都能被快速发现和修复。软件工程实践证明，越早发现缺陷，其修复成本越低。 **测试驱动开发**更是提倡测试先行，使用代码始终处于安全网防护之下。

#### 提高编码自信

单元测试总是能在你修改或重构代码即时反馈结果, 给予你调整的勇气，不用担心牵一发而动全身。帮助我们走向正反馈的道路，不断提高编码质量同时增强心理自信。

### 怎么做单元测试

#### 测试框架



#### 隔离框架

#### Live Unit Test

#### 最佳实践

测试流程:  

准备测试环境与条件(分配对象与资源等)

调用测试目标方法

验证被测试方法行为与期望是否一致

完成后清理各种资源

测试内容:   Right-BICEP

结果是否正确

边界条件 (Correct)

检查反向关联

交叉检查



Mock, Fake, Stub 对象



### 做什么

设计:

面向测试的设计

测试驱动的设计



### 不能

UI， 多线程，

### 示例

### 意识与心理层面

 单元测试是道理人人都懂，但大部分人都没有坚持下去的典范,  许多同学走着走着忘了初心，为测试而测试，

自信的编码

不写测试的借口: 编写测试太耗费时间与精力， 测试运行时间， 测试并不是我的工作, 不知道怎么写,  如果让QA失业感觉很难过....

单元测试学习曲线

我们大部分是普通人，"慢就是快"

### 总结

开发与测试本是一体，未测试代码不发布上线, 做时间的朋友。

1. 单元测试的定义和好处

2. 选择单元测试框架

3. 怎么给单元测试命名

4. 单元测试的组成

5. Stub（存根）和Mock（模拟对象）

6. 隔离框架

7. VisualStuio中的测试资源管理器、CodeLens和ReSharper

8. Live Unit Test

9. 代码覆盖率

10. 单元测试道_法_术

11. 单元测试熟练等级

12. 使用单元测试的最佳姿势

13. 通过实例说明单元测试

    

### 资料

#### 链接

https://docs.microsoft.com/zh-cn/visualstudio/test/unit-test-your-code?view=vs-2019

https://xunit.net/

https://docs.microsoft.com/zh-cn/dotnet/core/testing/unit-testing-code-coverage?tabs=windows

https://docs.microsoft.com/zh-cn/dotnet/core/testing/unit-testing-best-practices

http://xunitpatterns.com/Test%20Double.html

https://softchris.github.io/pages/dotnet-moq.html#the-api-project